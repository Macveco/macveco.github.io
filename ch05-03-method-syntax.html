<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>方法语法 | Macveco</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Macveco'blog">
    
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.3e0b5acf.js" as="script"><link rel="preload" href="/assets/js/2.196449eb.js" as="script"><link rel="preload" href="/assets/js/37.cde51a62.js" as="script"><link rel="prefetch" href="/assets/js/10.0632c93e.js"><link rel="prefetch" href="/assets/js/100.eb3e6d12.js"><link rel="prefetch" href="/assets/js/101.0b4cc527.js"><link rel="prefetch" href="/assets/js/102.4283d03d.js"><link rel="prefetch" href="/assets/js/103.b95b5966.js"><link rel="prefetch" href="/assets/js/104.c29a3b07.js"><link rel="prefetch" href="/assets/js/105.89147ba5.js"><link rel="prefetch" href="/assets/js/106.17faf747.js"><link rel="prefetch" href="/assets/js/107.9c034be2.js"><link rel="prefetch" href="/assets/js/108.1e8ed623.js"><link rel="prefetch" href="/assets/js/109.670f0a70.js"><link rel="prefetch" href="/assets/js/11.8f342f68.js"><link rel="prefetch" href="/assets/js/110.9d9c0d99.js"><link rel="prefetch" href="/assets/js/111.52dced72.js"><link rel="prefetch" href="/assets/js/112.fccd614d.js"><link rel="prefetch" href="/assets/js/113.89d70c70.js"><link rel="prefetch" href="/assets/js/114.586e23e0.js"><link rel="prefetch" href="/assets/js/115.c0a5fea9.js"><link rel="prefetch" href="/assets/js/116.60441a24.js"><link rel="prefetch" href="/assets/js/12.1720245c.js"><link rel="prefetch" href="/assets/js/13.061827fd.js"><link rel="prefetch" href="/assets/js/14.8a16e1c0.js"><link rel="prefetch" href="/assets/js/15.cc5922f2.js"><link rel="prefetch" href="/assets/js/16.6113206c.js"><link rel="prefetch" href="/assets/js/17.fded4074.js"><link rel="prefetch" href="/assets/js/18.8f1a6fc8.js"><link rel="prefetch" href="/assets/js/19.ed698fe0.js"><link rel="prefetch" href="/assets/js/20.ad5a3c2f.js"><link rel="prefetch" href="/assets/js/21.8a6fb8e9.js"><link rel="prefetch" href="/assets/js/22.f261005a.js"><link rel="prefetch" href="/assets/js/23.11330881.js"><link rel="prefetch" href="/assets/js/24.0db57df1.js"><link rel="prefetch" href="/assets/js/25.e92f9fa5.js"><link rel="prefetch" href="/assets/js/26.adc97b01.js"><link rel="prefetch" href="/assets/js/27.9f2d1d83.js"><link rel="prefetch" href="/assets/js/28.7223d35b.js"><link rel="prefetch" href="/assets/js/29.51f9bbbe.js"><link rel="prefetch" href="/assets/js/3.304fbc0b.js"><link rel="prefetch" href="/assets/js/30.5f72ef00.js"><link rel="prefetch" href="/assets/js/31.f5f768be.js"><link rel="prefetch" href="/assets/js/32.7320afa2.js"><link rel="prefetch" href="/assets/js/33.fa6a2dfd.js"><link rel="prefetch" href="/assets/js/34.de8985ef.js"><link rel="prefetch" href="/assets/js/35.00835c10.js"><link rel="prefetch" href="/assets/js/36.18022ea2.js"><link rel="prefetch" href="/assets/js/38.7f578b60.js"><link rel="prefetch" href="/assets/js/39.f5afafe7.js"><link rel="prefetch" href="/assets/js/4.7140270c.js"><link rel="prefetch" href="/assets/js/40.a6ace9c0.js"><link rel="prefetch" href="/assets/js/41.29188d85.js"><link rel="prefetch" href="/assets/js/42.db8d46c9.js"><link rel="prefetch" href="/assets/js/43.661a7921.js"><link rel="prefetch" href="/assets/js/44.aab66e80.js"><link rel="prefetch" href="/assets/js/45.854f6a6c.js"><link rel="prefetch" href="/assets/js/46.e4406cb1.js"><link rel="prefetch" href="/assets/js/47.d66d9701.js"><link rel="prefetch" href="/assets/js/48.58795296.js"><link rel="prefetch" href="/assets/js/49.213c1393.js"><link rel="prefetch" href="/assets/js/5.62c44729.js"><link rel="prefetch" href="/assets/js/50.4ba80a32.js"><link rel="prefetch" href="/assets/js/51.0ee15597.js"><link rel="prefetch" href="/assets/js/52.58bb605b.js"><link rel="prefetch" href="/assets/js/53.ef46056a.js"><link rel="prefetch" href="/assets/js/54.3ca4b4d9.js"><link rel="prefetch" href="/assets/js/55.6f004cba.js"><link rel="prefetch" href="/assets/js/56.6fcb182b.js"><link rel="prefetch" href="/assets/js/57.01654d70.js"><link rel="prefetch" href="/assets/js/58.2966bb0b.js"><link rel="prefetch" href="/assets/js/59.2bd7b651.js"><link rel="prefetch" href="/assets/js/6.0e179366.js"><link rel="prefetch" href="/assets/js/60.4a143bb3.js"><link rel="prefetch" href="/assets/js/61.2f5a829d.js"><link rel="prefetch" href="/assets/js/62.41cfe7e9.js"><link rel="prefetch" href="/assets/js/63.b807ff20.js"><link rel="prefetch" href="/assets/js/64.3ed5d409.js"><link rel="prefetch" href="/assets/js/65.bcb76f11.js"><link rel="prefetch" href="/assets/js/66.5a3e29a6.js"><link rel="prefetch" href="/assets/js/67.e1f1f6df.js"><link rel="prefetch" href="/assets/js/68.661dbaba.js"><link rel="prefetch" href="/assets/js/69.bc48b4b2.js"><link rel="prefetch" href="/assets/js/7.69a1ab9f.js"><link rel="prefetch" href="/assets/js/70.f47ca7c7.js"><link rel="prefetch" href="/assets/js/71.1b0dae57.js"><link rel="prefetch" href="/assets/js/72.760b0458.js"><link rel="prefetch" href="/assets/js/73.eab676db.js"><link rel="prefetch" href="/assets/js/74.f062ea07.js"><link rel="prefetch" href="/assets/js/75.d09dcc86.js"><link rel="prefetch" href="/assets/js/76.21d55f32.js"><link rel="prefetch" href="/assets/js/77.82d56c7a.js"><link rel="prefetch" href="/assets/js/78.f3be72d7.js"><link rel="prefetch" href="/assets/js/79.5ef7ee50.js"><link rel="prefetch" href="/assets/js/8.2da5093f.js"><link rel="prefetch" href="/assets/js/80.36846c75.js"><link rel="prefetch" href="/assets/js/81.4f1decf8.js"><link rel="prefetch" href="/assets/js/82.4bf22fd9.js"><link rel="prefetch" href="/assets/js/83.52977ab4.js"><link rel="prefetch" href="/assets/js/84.9ff8735a.js"><link rel="prefetch" href="/assets/js/85.9f5d58eb.js"><link rel="prefetch" href="/assets/js/86.428374d6.js"><link rel="prefetch" href="/assets/js/87.e9530957.js"><link rel="prefetch" href="/assets/js/88.6e2214de.js"><link rel="prefetch" href="/assets/js/89.307f9a01.js"><link rel="prefetch" href="/assets/js/9.29792057.js"><link rel="prefetch" href="/assets/js/90.89a77a3a.js"><link rel="prefetch" href="/assets/js/91.c1161184.js"><link rel="prefetch" href="/assets/js/92.303ca462.js"><link rel="prefetch" href="/assets/js/93.dfffbca2.js"><link rel="prefetch" href="/assets/js/94.6e61a0b9.js"><link rel="prefetch" href="/assets/js/95.c83cc83d.js"><link rel="prefetch" href="/assets/js/96.768e3907.js"><link rel="prefetch" href="/assets/js/97.e7540a34.js"><link rel="prefetch" href="/assets/js/98.85a61922.js"><link rel="prefetch" href="/assets/js/99.4a6a3ee6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="assets/img/homework.svg" alt="Macveco" class="logo"> <span class="site-name can-hide">Macveco</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://www.easyicon.net" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Easyicon
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://www.easyicon.net" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Easyicon
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>方法语法</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch05-03-method-syntax.html#方法语法" class="sidebar-link">方法语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ch05-03-method-syntax.html#定义方法" class="sidebar-link">定义方法</a></li><li class="sidebar-sub-header"><a href="/ch05-03-method-syntax.html#运算符到哪去了" class="sidebar-link">-&gt; 运算符到哪去了？</a></li><li class="sidebar-sub-header"><a href="/ch05-03-method-syntax.html#带有更多参数的方法" class="sidebar-link">带有更多参数的方法</a></li><li class="sidebar-sub-header"><a href="/ch05-03-method-syntax.html#关联函数" class="sidebar-link">关联函数</a></li><li class="sidebar-sub-header"><a href="/ch05-03-method-syntax.html#多个-impl-块" class="sidebar-link">多个 impl 块</a></li></ul></li><li><a href="/ch05-03-method-syntax.html#总结" class="sidebar-link">总结</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="方法语法"><a href="#方法语法" class="header-anchor">#</a> 方法语法</h2> <blockquote><p><a href="https://github.com/rust-lang/book/blob/master/src/ch05-03-method-syntax.md" target="_blank" rel="noopener noreferrer">ch05-03-method-syntax.md<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br>
commit a86c1d315789b3ca13b20d50ad5005c62bdd9e37</p></blockquote> <p><strong>方法</strong> 与函数类似：它们使用 <code>fn</code> 关键字和名称声明，可以拥有参数和返回值，同时包含在某处调用该方法时会执行的代码。不过方法与函数是不同的，因为它们在结构体的上下文中被定义（或者是枚举或 trait 对象的上下文，将分别在第六章和第十七章讲解），并且它们第一个参数总是 <code>self</code>，它代表调用该方法的结构体实例。</p> <h3 id="定义方法"><a href="#定义方法" class="header-anchor">#</a> 定义方法</h3> <p>让我们把前面实现的获取一个 <code>Rectangle</code> 实例作为参数的 <code>area</code> 函数，改写成一个定义于 <code>Rectangle</code> 结构体上的 <code>area</code> 方法，如示例 5-13 所示：</p> <p><span class="filename">文件名: src/main.rs</span></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Rectangle</span> <span class="token punctuation">{</span>
    width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    height<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;The area of the rectangle is {} square pixels.&quot;</span><span class="token punctuation">,</span>
        rect1<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><span class="caption">示例 5-13：在 <code>Rectangle</code> 结构体上定义 <code>area</code> 方法</span></p> <p>为了使函数定义于 <code>Rectangle</code> 的上下文中，我们开始了一个 <code>impl</code> 块（<code>impl</code> 是 <em>implementation</em> 的缩写）。接着将 <code>area</code> 函数移动到 <code>impl</code> 大括号中，并将签名中的第一个（在这里也是唯一一个）参数和函数体中其他地方的对应参数改成 <code>self</code>。然后在 <code>main</code> 中将我们先前调用 <code>area</code> 方法并传递 <code>rect1</code> 作为参数的地方，改成使用 <strong>方法语法</strong>（<em>method syntax</em>）在 <code>Rectangle</code> 实例上调用 <code>area</code> 方法。方法语法获取一个实例并加上一个点号，后跟方法名、圆括号以及任何参数。</p> <p>在 <code>area</code> 的签名中，使用 <code>&amp;self</code> 来替代 <code>rectangle: &amp;Rectangle</code>，因为该方法位于 <code>impl Rectangle</code> 上下文中所以 Rust 知道 <code>self</code> 的类型是 <code>Rectangle</code>。注意仍然需要在 <code>self</code> 前面加上 <code>&amp;</code>，就像 <code>&amp;Rectangle</code> 一样。方法可以选择获取 <code>self</code> 的所有权，或者像我们这里一样不可变地借用 <code>self</code>，或者可变地借用 <code>self</code>，就跟其他参数一样。</p> <p>这里选择 <code>&amp;self</code> 的理由跟在函数版本中使用 <code>&amp;Rectangle</code> 是相同的：我们并不想获取所有权，只希望能够读取结构体中的数据，而不是写入。如果想要在方法中改变调用方法的实例，需要将第一个参数改为 <code>&amp;mut self</code>。通过仅仅使用 <code>self</code> 作为第一个参数来使方法获取实例的所有权是很少见的；这种技术通常用在当方法将 <code>self</code> 转换成别的实例的时候，这时我们想要防止调用者在转换之后使用原始的实例。</p> <p>使用方法替代函数，除了可使用方法语法和不需要在每个函数签名中重复 <code>self</code> 的类型之外，其主要好处在于组织性。我们将某个类型实例能做的所有事情都一起放入 <code>impl</code> 块中，而不是让将来的用户在我们的库中到处寻找 <code>Rectangle</code> 的功能。</p> <blockquote><h3 id="运算符到哪去了"><a href="#运算符到哪去了" class="header-anchor">#</a> <code>-&gt;</code> 运算符到哪去了？</h3> <p>在 C/C++ 语言中，有两个不同的运算符来调用方法：<code>.</code> 直接在对象上调用方法，而 <code>-&gt;</code> 在一个对象的指针上调用方法，这时需要先解引用（dereference）指针。换句话说，如果 <code>object</code> 是一个指针，那么 <code>object-&gt;something()</code> 就像 <code>(*object).something()</code> 一样。</p> <p>Rust 并没有一个与 <code>-&gt;</code> 等效的运算符；相反，Rust 有一个叫 <strong>自动引用和解引用</strong>（<em>automatic referencing and dereferencing</em>）的功能。方法调用是 Rust 中少数几个拥有这种行为的地方。</p> <p>他是这样工作的：当使用 <code>object.something()</code> 调用方法时，Rust 会自动为 <code>object</code> 添加 <code>&amp;</code>、<code>&amp;mut</code> 或 <code>*</code> 以便使 <code>object</code> 与方法签名匹配。也就是说，这些代码是等价的：</p> <div class="language-rust extra-class"><pre class="language-rust"><code># <span class="token attribute attr-name">#[derive(Debug,Copy,Clone)]</span>
# <span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span> <span class="token punctuation">{</span>
#     x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span>
#     y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span>
# <span class="token punctuation">}</span>
#
# <span class="token keyword">impl</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
#    <span class="token keyword">fn</span> <span class="token function-definition function">distance</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">f64</span> <span class="token punctuation">{</span>
#        <span class="token keyword">let</span> x_squared <span class="token operator">=</span> <span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token function">powi</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
#        <span class="token keyword">let</span> y_squared <span class="token operator">=</span> <span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token function">powi</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
#
#        <span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token function">sqrt</span><span class="token punctuation">(</span>x_squared <span class="token operator">+</span> y_squared<span class="token punctuation">)</span>
#    <span class="token punctuation">}</span>
# <span class="token punctuation">}</span>
# <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
# <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">5.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">6.5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
p1<span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>第一行看起来简洁的多。这种自动引用的行为之所以有效，是因为方法有一个明确的接收者———— <code>self</code> 的类型。在给出接收者和方法名的前提下，Rust 可以明确地计算出方法是仅仅读取（<code>&amp;self</code>），做出修改（<code>&amp;mut self</code>）或者是获取所有权（<code>self</code>）。事实上，Rust 对方法接收者的隐式借用让所有权在实践中更友好。</p></blockquote> <h3 id="带有更多参数的方法"><a href="#带有更多参数的方法" class="header-anchor">#</a> 带有更多参数的方法</h3> <p>让我们通过实现 <code>Rectangle</code> 结构体上的另一方法来练习使用方法。这回，我们让一个 <code>Rectangle</code> 的实例获取另一个 <code>Rectangle</code> 实例，如果 <code>self</code> 能完全包含第二个长方形则返回 <code>true</code>；否则返回 <code>false</code>。一旦定义了 <code>can_hold</code> 方法，就可以编写示例 5-14 中的代码。</p> <p><span class="filename">文件名: src/main.rs</span></p> <div class="language-rust,ignore extra-class"><pre class="language-text"><code>fn main() {
    let rect1 = Rectangle { width: 30, height: 50 };
    let rect2 = Rectangle { width: 10, height: 40 };
    let rect3 = Rectangle { width: 60, height: 45 };

    println!(&quot;Can rect1 hold rect2? {}&quot;, rect1.can_hold(&amp;rect2));
    println!(&quot;Can rect1 hold rect3? {}&quot;, rect1.can_hold(&amp;rect3));
}
</code></pre></div><p><span class="caption">示例 5-14：使用还未实现的 <code>can_hold</code> 方法</span></p> <p>同时我们希望看到如下输出，因为 <code>rect2</code> 的两个维度都小于 <code>rect1</code>，而 <code>rect3</code> 比 <code>rect1</code> 要宽：</p> <div class="language-text extra-class"><pre class="language-text"><code>Can rect1 hold rect2? true
Can rect1 hold rect3? false
</code></pre></div><p>因为我们想定义一个方法，所以它应该位于 <code>impl Rectangle</code> 块中。方法名是 <code>can_hold</code>，并且它会获取另一个 <code>Rectangle</code> 的不可变借用作为参数。通过观察调用方法的代码可以看出参数是什么类型的：<code>rect1.can_hold(&amp;rect2)</code> 传入了 <code>&amp;rect2</code>，它是一个 <code>Rectangle</code> 的实例 <code>rect2</code> 的不可变借用。这是可以理解的，因为我们只需要读取 <code>rect2</code>（而不是写入，这意味着我们需要一个不可变借用），而且希望 <code>main</code> 保持 <code>rect2</code> 的所有权，这样就可以在调用这个方法后继续使用它。<code>can_hold</code> 的返回值是一个布尔值，其实现会分别检查 <code>self</code> 的宽高是否都大于另一个 <code>Rectangle</code>。让我们在示例 5-13 的 <code>impl</code> 块中增加这个新的 <code>can_hold</code> 方法，如示例 5-15 所示：</p> <p><span class="filename">文件名: src/main.rs</span></p> <div class="language-rust extra-class"><pre class="language-rust"><code># <span class="token attribute attr-name">#[derive(Debug)]</span>
# <span class="token keyword">struct</span> <span class="token type-definition class-name">Rectangle</span> <span class="token punctuation">{</span>
#     width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
#     height<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
# <span class="token punctuation">}</span>
#
<span class="token keyword">impl</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">can_hold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Rectangle</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">&gt;</span> other<span class="token punctuation">.</span>width <span class="token operator">&amp;&amp;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height <span class="token operator">&gt;</span> other<span class="token punctuation">.</span>height
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><span class="caption">示例 5-15：在 <code>Rectangle</code> 上实现 <code>can_hold</code> 方法，它获取另一个 <code>Rectangle</code> 实例作为参数</span></p> <p>如果结合示例 5-14 的 <code>main</code> 函数来运行，就会看到期望的输出。在方法签名中，可以在 <code>self</code> 后增加多个参数，而且这些参数就像函数中的参数一样工作。</p> <h3 id="关联函数"><a href="#关联函数" class="header-anchor">#</a> 关联函数</h3> <p><code>impl</code> 块的另一个有用的功能是：允许在 <code>impl</code> 块中定义 <strong>不</strong> 以 <code>self</code> 作为参数的函数。这被称为 <strong>关联函数</strong>（<em>associated functions</em>），因为它们与结构体相关联。它们仍是函数而不是方法，因为它们并不作用于一个结构体的实例。你已经使用过 <code>String::from</code> 关联函数了。</p> <p>关联函数经常被用作返回一个结构体新实例的构造函数。例如我们可以提供一个关联函数，它接受一个维度参数并且同时作为宽和高，这样可以更轻松的创建一个正方形 <code>Rectangle</code> 而不必指定两次同样的值：</p> <p><span class="filename">文件名: src/main.rs</span></p> <div class="language-rust extra-class"><pre class="language-rust"><code># <span class="token attribute attr-name">#[derive(Debug)]</span>
# <span class="token keyword">struct</span> <span class="token type-definition class-name">Rectangle</span> <span class="token punctuation">{</span>
#     width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
#     height<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
# <span class="token punctuation">}</span>
#
<span class="token keyword">impl</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">square</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
        <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span> width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用结构体名和 <code>::</code> 语法来调用这个关联函数：比如 <code>let sq = Rectangle::square(3);</code>。这个方法位于结构体的命名空间中：<code>::</code> 语法用于关联函数和模块创建的命名空间。第七章会讲到模块。</p> <h3 id="多个-impl-块"><a href="#多个-impl-块" class="header-anchor">#</a> 多个 <code>impl</code> 块</h3> <p>每个结构体都允许拥有多个 <code>impl</code> 块。例如，示例 5-16 中的代码等同于示例 5-15，但每个方法有其自己的 <code>impl</code> 块。</p> <div class="language-rust extra-class"><pre class="language-rust"><code># <span class="token attribute attr-name">#[derive(Debug)]</span>
# <span class="token keyword">struct</span> <span class="token type-definition class-name">Rectangle</span> <span class="token punctuation">{</span>
#     width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
#     height<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
# <span class="token punctuation">}</span>
#
<span class="token keyword">impl</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">can_hold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Rectangle</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">&gt;</span> other<span class="token punctuation">.</span>width <span class="token operator">&amp;&amp;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height <span class="token operator">&gt;</span> other<span class="token punctuation">.</span>height
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><span class="caption">示例 5-16：使用多个 <code>impl</code> 块重写示例 5-15</span></p> <p>这里没有理由将这些方法分散在多个 <code>impl</code> 块中，不过这是有效的语法。第十章讨论泛型和 trait 时会看到实用的多 <code>impl</code> 块的用例。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>结构体让你可以创建出在你的领域中有意义的自定义类型。通过结构体，我们可以将相关联的数据片段联系起来并命名它们，这样可以使得代码更加清晰。方法允许为结构体实例指定行为，而关联函数将特定功能置于结构体的命名空间中并且无需一个实例。</p> <p>但结构体并不是创建自定义类型的唯一方法：让我们转向 Rust 的枚举功能，为你的工具箱再添一个工具。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3e0b5acf.js" defer></script><script src="/assets/js/2.196449eb.js" defer></script><script src="/assets/js/37.cde51a62.js" defer></script>
  </body>
</html>
